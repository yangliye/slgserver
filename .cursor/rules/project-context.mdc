---
description: SLG Server 项目上下文 - 帮助 AI 快速理解项目背景
globs:
alwaysApply: true
---

# SLG Server 项目上下文

## 项目概述
这是一个 SLG（策略类）游戏服务器框架，使用 Java 25 + Gradle 9.1 构建。
项目采用多模块结构，专注于高性能、低延迟的游戏服务端开发。

## 模块结构

```
slgserver/
├── common/     # 通用工具库（TimeUtils, HttpUtils, JsonUtils, IdGenerator 等）
├── rpc/        # RPC 框架（基于 Netty 4.2，Protostuff 序列化，ZooKeeper 服务发现）
├── db/         # 数据库框架（HikariCP 连接池，异步落地，变更追踪）
└── build.ps1   # PowerShell 打包脚本
```

## 核心技术栈

| 组件 | 技术 | 版本 |
|-----|-----|-----|
| JDK | Java | 25 |
| 构建 | Gradle | 9.1 |
| 网络 | Netty | 4.2.9.Final |
| 序列化 | Protostuff | 1.8.0 |
| 服务发现 | Curator/ZooKeeper | 5.9.0 |
| 连接池 | HikariCP | 6.3.0 |
| JSON | FastJSON2 | 2.0.60 |
| HTTP | OkHttp | 5.3.2 |
| 日志 | SLF4J + Logback | 2.0.17 / 1.5.27 |

## 代码规范

1. **时间获取**：全局使用 `TimeUtils.currentTimeMillis()` 而非 `System.currentTimeMillis()`，便于时间偏移测试
2. **内部类**：不使用内部类，所有类应单独提取为独立文件
3. **临时脚本**：放到 `D:\workspace\cursor` 目录，优先使用 Go 语言
4. **Protobuf**：调用方法前必须先 grep 确认方法名存在，不凭推测

## 工具类说明 (common 模块)

- `TimeUtils` - 时间工具（支持时间偏移、SLG 常用时间计算）
- `IdGenerator` - ID 生成器（Snowflake 算法，12位serverId + 10位序列号）
- `HttpUtils` - HTTP 客户端（基于 OkHttp，支持同步/异步）
- `JsonUtils` - JSON 序列化（基于 FastJSON2）
- `XmlUtils` - XML 解析（基于 Dom4j）
- `CryptoUtils` - 加密工具（MD5, SHA, AES, HMAC, 签名验证）
- `StringUtil` - 字符串工具（敏感词过滤、格式验证）
- `RandomUtils` - 随机数工具（权重随机、概率检查）
- `MathUtils` - 数学工具（防溢出运算、距离计算）
- `CollectionUtils` - 集合工具
- `BitUtils` - 位运算工具（游戏常用的位标记）

## RPC 框架特性

- 基于 Netty 的高性能 RPC
- Protostuff 序列化（比 JSON 快 10 倍）
- ZooKeeper 服务注册与发现
- 连接池管理
- 时间轮超时检测
- 支持单向调用（oneWay）

## DB 框架特性

- 异步批量落地（提高吞吐量）
- 变更追踪（只写入变化的字段）
- 自适应调节（根据负载动态调整批量大小）
- 乐观锁支持

## 常用命令

```powershell
# 编译（跳过测试）
.\build.ps1 -SkipTests

# 编译指定模块
.\build.ps1 -Module common

# 清理并编译
.\build.ps1 -Clean

# 运行测试
.\gradlew :common:test
.\gradlew :rpc:test
.\gradlew :db:test

# 发布到本地 Maven
.\gradlew publishToMavenLocal
```

## GitHub 仓库

https://github.com/yangliye/slgserver
